$.fn.cube=function(a){function c(a){var c=["U","u","R","r","D","d","L","l","F","f","B","b","M","E","S","X","Y","Z","2","'"];a=a.replace(/\(/gm,"").replace(/\)/gm,"").replace(/\[/gm,"").replace(/\]/gm,"").replace(/\n/gm," "),a=a.replace(/Fw/gm,"f").replace(/Bw/gm,"b").replace(/Rw/gm,"r").replace(/Lw/gm,"l").replace(/Uw/gm,"u").replace(/Dw/gm,"d").replace(/x/gm,"X").replace(/y/gm,"Y").replace(/z/gm,"Z");for(var t=a.split(" "),o=[],r=0;r<t.length;r++){var e=t[r];if(!(0==e.length||e.length>3)){for(var s=!0,n=0;n<e.length;n++){var d=e[n];if($.inArray(d,c)<0){s=!1;break}}if(s){var i=e[1];if($.isNumeric(i))for(e=e.replace(e[1],"");i--;)o.push(e);else o.push(e)}}}return o}function t(c,t){var o=0,r=c.length;$(c).each(function(){var c=$(this),e=c.data("pos");if(t){var s="translate3d("+e.x+"px,"+e.y+"px,"+e.z+"px)",n=0,d=0,i=0;c.animate({rotateX:e.ox,rotateY:e.oy,rotateZ:e.oz},{duration:a.animation.delay,step:function(a,t){switch(t.prop){case"rotateX":n=a;break;case"rotateY":d=a;break;case"rotateZ":i=a}c.css({transform:"rotateX("+n+"deg) rotateY("+d+"deg) rotateZ("+i+"deg) "+s})},complete:function(){c.animate({rotateX:0,rotateY:0,rotateZ:0},0).css({transform:"rotateX(0deg) rotateY(0deg) rotateZ(0deg) "+s}),o++,o==r&&f.trigger("next-move")}})}else c.css({transform:"rotateX("+e.ox+"deg) rotateY("+e.oy+"deg) rotateZ("+e.oz+"deg) translate3d("+e.x+"px,"+e.y+"px,"+e.z+"px)"})})}function o(){var a=f.data("from"),c=f.data("to");if(a&&c){var t=[];$(c).each(function(){t.push({f1:$(this).find(".f1").css("background-color"),f2:$(this).find(".f2").css("background-color"),f3:$(this).find(".f3").css("background-color"),f4:$(this).find(".f4").css("background-color"),f5:$(this).find(".f5").css("background-color"),f6:$(this).find(".f6").css("background-color")})}),$(a).each(function(){var a=t.shift();$(this).find(".f1").css("background-color",a.f1),$(this).find(".f2").css("background-color",a.f2),$(this).find(".f3").css("background-color",a.f3),$(this).find(".f4").css("background-color",a.f4),$(this).find(".f5").css("background-color",a.f5),$(this).find(".f6").css("background-color",a.f6)})}}function r(a,c){switch(a){case"y":switch(c){case 0:return[u[0].get(0),u[1].get(0),u[2].get(0),u[9].get(0),u[10].get(0),u[11].get(0),u[18].get(0),u[19].get(0),u[20].get(0)];case 1:return[u[3].get(0),u[4].get(0),u[5].get(0),u[12].get(0),u[13].get(0),u[14].get(0),u[21].get(0),u[22].get(0),u[23].get(0)];case 2:return[u[6].get(0),u[7].get(0),u[8].get(0),u[15].get(0),u[16].get(0),u[17].get(0),u[24].get(0),u[25].get(0),u[26].get(0)]}case"x":switch(c){case 0:return[u[6].get(0),u[3].get(0),u[0].get(0),u[15].get(0),u[12].get(0),u[9].get(0),u[24].get(0),u[21].get(0),u[18].get(0)];case 1:return[u[7].get(0),u[4].get(0),u[1].get(0),u[16].get(0),u[13].get(0),u[10].get(0),u[25].get(0),u[22].get(0),u[19].get(0)];case 2:return[u[8].get(0),u[5].get(0),u[2].get(0),u[17].get(0),u[14].get(0),u[11].get(0),u[26].get(0),u[23].get(0),u[20].get(0)]}case"z":switch(c){case 0:return[u[6].get(0),u[7].get(0),u[8].get(0),u[3].get(0),u[4].get(0),u[5].get(0),u[0].get(0),u[1].get(0),u[2].get(0)];case 1:return[u[15].get(0),u[16].get(0),u[17].get(0),u[12].get(0),u[13].get(0),u[14].get(0),u[9].get(0),u[10].get(0),u[11].get(0)];case 2:return[u[24].get(0),u[25].get(0),u[26].get(0),u[21].get(0),u[22].get(0),u[23].get(0),u[18].get(0),u[19].get(0),u[20].get(0)]}}}function e(a,c){return"cw"==c?[a[6],a[3],a[0],a[7],a[4],a[1],a[8],a[5],a[2]]:[a[2],a[5],a[8],a[1],a[4],a[7],a[0],a[3],a[6]]}function s(){var a=f.data("from");a&&$(a).each(function(){var a=$(this),c=a.data("pos"),t=a.find(".f1"),o=a.find(".f2"),r=a.find(".f3"),e=a.find(".f4"),s=a.find(".f5"),n=a.find(".f6");switch(c.oy){case-90:var d=t.css("background-color");t.css("background-color",o.css("background-color")),o.css("background-color",r.css("background-color")),r.css("background-color",e.css("background-color")),e.css("background-color",d);break;case 90:var d=e.css("background-color");e.css("background-color",r.css("background-color")),r.css("background-color",o.css("background-color")),o.css("background-color",t.css("background-color")),t.css("background-color",d)}switch(c.ox){case-90:var d=t.css("background-color");t.css("background-color",s.css("background-color")),s.css("background-color",r.css("background-color")),r.css("background-color",n.css("background-color")),n.css("background-color",d);break;case 90:var d=t.css("background-color");t.css("background-color",n.css("background-color")),n.css("background-color",r.css("background-color")),r.css("background-color",s.css("background-color")),s.css("background-color",d)}switch(c.oz){case-90:var d=s.css("background-color");s.css("background-color",o.css("background-color")),o.css("background-color",n.css("background-color")),n.css("background-color",e.css("background-color")),e.css("background-color",d);break;case 90:var d=s.css("background-color");s.css("background-color",e.css("background-color")),e.css("background-color",n.css("background-color")),n.css("background-color",o.css("background-color")),o.css("background-color",d)}c.ox=0,c.oy=0,c.oz=0})}function n(c){var t=$("<div>").addClass("cubit").css({width:a.cubit.width+"px",height:a.cubit.height+"px"});f.append(t);for(var o=0;6>o;o++){var r=$("<div>").addClass("face f"+(o+1)).css({width:a.cubit.width+"px",height:a.cubit.height+"px"});switch(t.append(r),o){case 0:r.css({transform:"translateZ("+a.cubit.width/2+"px)"});break;case 1:r.css({left:a.cubit.width/2+"px",transform:"rotateY(90deg)"});break;case 2:r.css({transform:"translateZ("+-(a.cubit.width/2)+"px) rotateY(180deg)"});break;case 3:r.css({left:-(a.cubit.width/2)+"px",transform:"rotateY(-90deg)"});break;case 4:r.css({top:-(a.cubit.width/2)+"px",transform:"rotateX(90deg)"});break;case 5:r.css({top:a.cubit.width/2+"px",transform:"rotateX(90deg) rotateY(180deg)"})}}return t.data("pos",c),u.push(t),t}function d(){for(var c=0;c<u.length;c++)for(var t=u[c],o=0;6>o;o++)t.find(".f"+(o+1)).css("background-color",a.color[o])}function i(){a.cubit={width:a.size.width/3,height:a.size.height/3};for(var c=-a.cubit.width;c<2*a.cubit.width;c+=a.cubit.width)for(var o=0;9>o;o++){var r={x:0,y:0,z:c,ox:0,oy:0,oz:0};switch(o){case 0:r.x-=a.cubit.width,r.y-=a.cubit.height;break;case 1:r.y-=a.cubit.height;break;case 2:r.x+=a.cubit.width,r.y-=a.cubit.height;break;case 3:r.x-=a.cubit.width;break;case 4:break;case 5:r.x+=a.cubit.width;break;case 6:r.x-=a.cubit.width,r.y+=a.cubit.height;break;case 7:r.y+=a.cubit.height;break;case 8:r.x+=a.cubit.width,r.y+=a.cubit.height}n(r)}t(f.find(".cubit"),!1),d()}var g={position:{x:0,y:0,ox:0,oy:0},size:{width:150,height:150},color:["red","green","orange","blue","yellow","white"],animation:{delay:250}};a=$.extend(g,a);var f=this,u=[];return f.turn=function(a){switch(a){case"U":var c=r("y",0),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=-90});break;case"U'":var c=r("y",0),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=90});break;case"u":var s=r("y",0),n=r("y",1),c=s.concat(n),d=e(s,"cw"),i=e(n,"cw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=-90});break;case"u'":var s=r("y",0),n=r("y",1),c=s.concat(n),d=e(s,"ccw"),i=e(n,"ccw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=90});break;case"R":var c=r("x",2),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=90});break;case"R'":var c=r("x",2),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=-90});break;case"r":var s=r("x",2),n=r("x",1),c=s.concat(n),d=e(s,"ccw"),i=e(n,"ccw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=90});break;case"r'":var s=r("x",2),n=r("x",1),c=s.concat(n),d=e(s,"cw"),i=e(n,"cw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=-90});break;case"D":var c=r("y",2),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=90});break;case"D'":var c=r("y",2),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=-90});break;case"d":var s=r("y",2),n=r("y",1),c=s.concat(n),d=e(s,"ccw"),i=e(n,"ccw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=90});break;case"d'":var s=r("y",2),n=r("y",1),c=s.concat(n),d=e(s,"cw"),i=e(n,"cw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=-90});break;case"L":var c=r("x",0),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=-90});break;case"L'":var c=r("x",0),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=90});break;case"l":var s=r("x",0),n=r("x",1),c=s.concat(n),d=e(s,"cw"),i=e(n,"cw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=-90});break;case"l'":var s=r("x",0),n=r("x",1),c=s.concat(n),d=e(s,"ccw"),i=e(n,"ccw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=-90});break;case"F":var c=r("z",2),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=90});break;case"F'":var c=r("z",2),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=-90});break;case"f":var s=r("z",2),n=r("z",1),c=s.concat(n),d=e(s,"ccw"),i=e(n,"ccw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=-90});break;case"f'":var s=r("z",2),n=r("z",1),c=s.concat(n),d=e(s,"cw"),i=e(n,"cw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=-90});break;case"B":var c=r("z",0),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=-90});break;case"B'":var c=r("z",0),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=90});break;case"b":var s=r("z",0),n=r("z",1),c=s.concat(n),d=e(s,"cw"),i=e(n,"cw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=-90});break;case"b'":var s=r("z",0),n=r("z",1),c=s.concat(n),d=e(s,"ccw"),i=e(n,"ccw"),o=d.concat(i);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=90});break;case"M":var c=r("x",1),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=-90});break;case"M'":var c=r("x",1),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=90});break;case"E":var c=r("y",1),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=-90});break;case"E'":var c=r("y",1),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=90});break;case"S":var c=r("z",1),o=e(c,"ccw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=90});break;case"S'":var c=r("z",1),o=e(c,"cw");f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=-90});break;case"X":var s=r("x",2),n=r("x",1),g=r("x",0),c=s.concat(n).concat(g),d=e(s,"ccw"),i=e(n,"ccw"),u=e(g,"ccw"),o=d.concat(i).concat(u);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=90});break;case"X'":var s=r("x",2),n=r("x",1),g=r("x",0),c=s.concat(n).concat(g),d=e(s,"cw"),i=e(n,"cw"),u=e(g,"cw"),o=d.concat(i).concat(u);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.ox=-90});break;case"Y":var s=r("y",0),n=r("y",1),g=r("y",2),c=s.concat(n).concat(g),d=e(s,"cw"),i=e(n,"cw"),u=e(g,"cw"),o=d.concat(i).concat(u);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=-90});break;case"Y'":var s=r("y",0),n=r("y",1),g=r("y",2),c=s.concat(n).concat(g),d=e(s,"ccw"),i=e(n,"ccw"),u=e(g,"ccw"),o=d.concat(i).concat(u);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oy=90});break;case"Z":var s=r("z",0),n=r("z",1),g=r("z",2),c=s.concat(n).concat(g),d=e(s,"cw"),i=e(n,"cw"),u=e(g,"cw"),o=d.concat(i).concat(u);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=-90});break;case"Z'":var s=r("z",0),n=r("z",1),g=r("z",2),c=s.concat(n).concat(g),d=e(s,"ccw"),i=e(n,"ccw"),u=e(g,"ccw"),o=d.concat(i).concat(u);f.data("from",c),f.data("to",o),$(c).each(function(){var a=$(this).data("pos");a.oz=90});break;default:return}t(c,!0)},f.execute=function(a){a=c(a),console.info(a),f.data("move-stack",a),f.trigger("next-move")},f.on("next-move",function(){s(),o(),f.data("from",null),f.data("to",null);var a=f.data("move-stack");if(a){console.info("moves",a);var c=a.shift();c||(a=null),f.data("move-stack",a),c&&f.turn(c)}}),i(),f.data("_cube",f),f};
